---
gem: puma
cve: 2024-45614
ghsa: 9hf4-67fc-4vf4
url: https://github.com/puma/puma/security/advisories/GHSA-9hf4-67fc-4vf4
title: Puma's header normalization allows for client to clobber proxy set headers
date: 2024-09-20
description: "### Impact\n\nClients could clobber values set by intermediate proxies
  (such as X-Forwarded-For) by providing a underscore version of the same header (X-Forwarded_For).
  Any users trusting headers set by their proxy may be affected. Attackers may be
  able to downgrade connections to HTTP (non-SSL) or redirect responses, which could
  cause confidentiality leaks if combined with a separate MITM attack. \n\n### Patches\nv6.4.3/v5.6.9
  now discards any headers using underscores if the non-underscore version also exists.
  Effectively, allowing the proxy defined headers to always win.\n\n### Workarounds\nNginx
  has a [underscores_in_headers](https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers)
  configuration variable to discard these headers at the proxy level.\n\nAny users
  that are implicitly trusting the proxy defined headers for security or availability
  should immediately cease doing so until upgraded to the fixed versions."
cvss_v3: 5.4
unaffected_versions:
- "<OPTIONAL: FILL IN SEE BELOW>"
patched_versions:
- "<FILL IN SEE BELOW>"


# GitHub advisory data below - **Remove this data before committing**
# Use this data to write patched_versions (and potentially unaffected_versions) above
---
identifiers:
- type: GHSA
  value: GHSA-9hf4-67fc-4vf4
- type: CVE
  value: CVE-2024-45614
summary: Puma's header normalization allows for client to clobber proxy set headers
description: "### Impact\n\nClients could clobber values set by intermediate proxies
  (such as X-Forwarded-For) by providing a underscore version of the same header (X-Forwarded_For).
  Any users trusting headers set by their proxy may be affected. Attackers may be
  able to downgrade connections to HTTP (non-SSL) or redirect responses, which could
  cause confidentiality leaks if combined with a separate MITM attack. \n\n### Patches\nv6.4.3/v5.6.9
  now discards any headers using underscores if the non-underscore version also exists.
  Effectively, allowing the proxy defined headers to always win.\n\n### Workarounds\nNginx
  has a [underscores_in_headers](https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers)
  configuration variable to discard these headers at the proxy level.\n\nAny users
  that are implicitly trusting the proxy defined headers for security or availability
  should immediately cease doing so until upgraded to the fixed versions."
severity: MODERATE
cvss:
  score: 5.4
  vectorString: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:L/A:N
references:
- url: https://github.com/puma/puma/security/advisories/GHSA-9hf4-67fc-4vf4
- url: https://nvd.nist.gov/vuln/detail/CVE-2024-45614
- url: https://github.com/puma/puma/commit/cac3fd18cf29ed43719ff5d52d9cfec215f0a043
- url: https://github.com/puma/puma/commit/f196b23be24712fb8fb16051cc124798cc84f70e
- url: https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers
- url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/puma/CVE-2024-45614.yml
- url: https://github.com/advisories/GHSA-9hf4-67fc-4vf4
publishedAt: '2024-09-20T14:40:16Z'
withdrawnAt: 
vulnerabilities:
- package:
    name: puma
    ecosystem: RUBYGEMS
  vulnerableVersionRange: ">= 6.0.0, < 6.4.3"
  firstPatchedVersion:
    identifier: 6.4.3
- package:
    name: puma
    ecosystem: RUBYGEMS
  vulnerableVersionRange: "< 5.6.9"
  firstPatchedVersion:
    identifier: 5.6.9
