---
gem: actiontext
cve: 2024-34341
ghsa: qjqp-xr96-cj99
url: https://github.com/basecamp/trix/security/advisories/GHSA-qjqp-xr96-cj99
title: Trix Editor Arbitrary Code Execution Vulnerability
date: 2024-05-07
description: "The Trix editor, versions prior to 2.1.1, is vulnerable to arbitrary
  code execution when copying and pasting content from the web or other documents
  with markup into the editor. The vulnerability stems from improper sanitization
  of pasted content, allowing an attacker to embed malicious scripts which are executed
  within the context of the application.\n\n**Vulnerable Versions**: \n\n- 1.x series
  up to and including 1.3.1\n- 2.x series up to and including 2.1.0\n\n**Fixed Versions**:
  \n\n- v1.3.2\n- v2.1.1\n\n**Vector**:\n\n- **Bug 1**: When copying content manipulated
  by a script, such as:\n\n```js\ndocument.addEventListener('copy', function(e){\n
  \ e.clipboardData.setData('text/html', '<div><noscript><div class=\"123</noscript>456<img
  src=1 onerror=alert(1)//\"></div></noscript></div>');\n  e.preventDefault();\n});\n```\n\nand
  pasting into the Trix editor, the script within the content is executed.\n\n- **Bug
  2**: Similar execution occurs with content structured as:\n\n```js\ndocument.write(`copy<div
  data-trix-attachment=\"{&quot;contentType&quot;:&quot;text/html&quot;,&quot;content&quot;:&quot;&lt;img
  src=1 onerror=alert(101)&gt;HELLO123&quot;}\"></div>me`);\n```\n\n### Impact:\nAn
  attacker could exploit these vulnerabilities to execute arbitrary JavaScript code
  within the context of the user's session, potentially leading to unauthorized actions
  being performed or sensitive information being disclosed.\n\n### Remediation:\n\n**Update
  Recommendation**: Users should upgrade to Trix editor version 2.1.1 or later, which
  incorporates proper sanitization of input from copied content.\n\n**CSP Enhancement**:
  Additionally, enhancing the Content Security Policy (CSP) to disallow inline scripts
  can significantly mitigate the risk of such vulnerabilities. Set CSP policies such
  as script-src 'self' to ensure that only scripts hosted on the same origin are executed,
  and explicitly prohibit inline scripts using script-src-elem.\n\n### References:\n
  \ - https://github.com/basecamp/trix/releases/tag/v2.1.1\n  - https://github.com/basecamp/trix/pull/1147\n
  \ - https://github.com/basecamp/trix/pull/1149\n  - https://github.com/basecamp/trix/pull/1153\n\n**Credit**:
  These issues were reported by security researchers [loknop](https://hackerone.com/loknop)
  and [pinpie](https://hackerone.com/pinpie)."
cvss_v3: 5.4
unaffected_versions:
- "<OPTIONAL: FILL IN SEE BELOW>"
patched_versions:
- "<FILL IN SEE BELOW>"


# GitHub advisory data below - **Remove this data before committing**
# Use this data to write patched_versions (and potentially unaffected_versions) above
---
identifiers:
- type: GHSA
  value: GHSA-qjqp-xr96-cj99
- type: CVE
  value: CVE-2024-34341
summary: Trix Editor Arbitrary Code Execution Vulnerability
description: "The Trix editor, versions prior to 2.1.1, is vulnerable to arbitrary
  code execution when copying and pasting content from the web or other documents
  with markup into the editor. The vulnerability stems from improper sanitization
  of pasted content, allowing an attacker to embed malicious scripts which are executed
  within the context of the application.\n\n**Vulnerable Versions**: \n\n- 1.x series
  up to and including 1.3.1\n- 2.x series up to and including 2.1.0\n\n**Fixed Versions**:
  \n\n- v1.3.2\n- v2.1.1\n\n**Vector**:\n\n- **Bug 1**: When copying content manipulated
  by a script, such as:\n\n```js\ndocument.addEventListener('copy', function(e){\n
  \ e.clipboardData.setData('text/html', '<div><noscript><div class=\"123</noscript>456<img
  src=1 onerror=alert(1)//\"></div></noscript></div>');\n  e.preventDefault();\n});\n```\n\nand
  pasting into the Trix editor, the script within the content is executed.\n\n- **Bug
  2**: Similar execution occurs with content structured as:\n\n```js\ndocument.write(`copy<div
  data-trix-attachment=\"{&quot;contentType&quot;:&quot;text/html&quot;,&quot;content&quot;:&quot;&lt;img
  src=1 onerror=alert(101)&gt;HELLO123&quot;}\"></div>me`);\n```\n\n### Impact:\nAn
  attacker could exploit these vulnerabilities to execute arbitrary JavaScript code
  within the context of the user's session, potentially leading to unauthorized actions
  being performed or sensitive information being disclosed.\n\n### Remediation:\n\n**Update
  Recommendation**: Users should upgrade to Trix editor version 2.1.1 or later, which
  incorporates proper sanitization of input from copied content.\n\n**CSP Enhancement**:
  Additionally, enhancing the Content Security Policy (CSP) to disallow inline scripts
  can significantly mitigate the risk of such vulnerabilities. Set CSP policies such
  as script-src 'self' to ensure that only scripts hosted on the same origin are executed,
  and explicitly prohibit inline scripts using script-src-elem.\n\n### References:\n
  \ - https://github.com/basecamp/trix/releases/tag/v2.1.1\n  - https://github.com/basecamp/trix/pull/1147\n
  \ - https://github.com/basecamp/trix/pull/1149\n  - https://github.com/basecamp/trix/pull/1153\n\n**Credit**:
  These issues were reported by security researchers [loknop](https://hackerone.com/loknop)
  and [pinpie](https://hackerone.com/pinpie)."
severity: MODERATE
cvss:
  score: 5.4
  vectorString: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N
references:
- url: https://github.com/basecamp/trix/security/advisories/GHSA-qjqp-xr96-cj99
- url: https://github.com/basecamp/trix/pull/1147
- url: https://github.com/basecamp/trix/pull/1149
- url: https://github.com/basecamp/trix/commit/1a5c68a14d48421fc368e30026f4a7918028b7ad
- url: https://github.com/basecamp/trix/commit/841ff19b53f349915100bca8fcb488214ff93554
- url: https://github.com/basecamp/trix/releases/tag/v2.1.1
- url: https://nvd.nist.gov/vuln/detail/CVE-2024-34341
- url: https://github.com/rails/rails/commit/07e6c88cc4defe6f6b8d28e79eb13a518e15b14c
- url: https://github.com/rails/rails/commit/260cb392fc1ee91d0b749cff08d1c8d54b230bd3
- url: https://github.com/rails/rails/commit/73fac32511eefdd45d8f00fecc2b8cc5408ea6d5
- url: https://discuss.rubyonrails.org/t/xss-vulnerabilities-in-trix-editor/85803
- url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actiontext/CVE-2024-34341.yml
- url: https://rubyonrails.org/2024/5/17/Rails-Versions-7-0-8-2-and-7-1-3-3-have-been-released
- url: https://rubyonrails.org/2024/5/17/Rails-Versions-7-0-8-3-has-been-released
- url: https://github.com/advisories/GHSA-qjqp-xr96-cj99
publishedAt: '2024-05-07T16:49:24Z'
withdrawnAt: 
vulnerabilities:
- package:
    name: actiontext
    ecosystem: RUBYGEMS
  vulnerableVersionRange: ">= 7.1.0.beta1, < 7.1.3.3"
  firstPatchedVersion:
    identifier: 7.1.3.3
- package:
    name: actiontext
    ecosystem: RUBYGEMS
  vulnerableVersionRange: ">= 7.0.0.alpha1, < 7.0.8.3"
  firstPatchedVersion:
    identifier: 7.0.8.3
