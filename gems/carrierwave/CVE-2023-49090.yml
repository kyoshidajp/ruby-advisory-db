---
gem: carrierwave
cve: 2023-49090
ghsa: gxhx-g4fq-49hj
url: https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-gxhx-g4fq-49hj
title: CarrierWave Content-Type allowlist bypass vulnerability, possibly leading to
  XSS
date: 2023-11-29
description: "### Impact\n[CarrierWave::Uploader::ContentTypeAllowlist](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/content_type_allowlist.rb)
  has a Content-Type allowlist bypass vulnerability, possibly leading to XSS. \n\nThe
  validation in `allowlisted_content_type?` determines Content-Type permissions by
  performing a partial match.\nIf the `content_type` argument of `allowlisted_content_type?`
  is passed a value crafted by the attacker, Content-Types not included in the `content_type_allowlist`
  will be allowed.\n\nIn addition, by setting the Content-Type configured by the attacker
  at the time of file delivery, it is possible to cause XSS on the user's browser
  when the uploaded file is opened.\n\n### Patches\nUpgrade to [3.0.5](https://rubygems.org/gems/carrierwave/versions/3.0.5)
  or [2.2.5](https://rubygems.org/gems/carrierwave/versions/2.2.5).\n\n### Workarounds\nWhen
  validating with `allowlisted_content_type?` in [CarrierWave::Uploader::ContentTypeAllowlist](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/content_type_allowlist.rb)
  , forward match(`\\A`) the Content-Type set in `content_type_allowlist`, preventing
  unintentional permission of `text/html;image/png` when you want to allow only `image/png`
  in `content_type_allowlist`.\n\n### References\n[OWASP - File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html#content-type-validation)\n"
cvss_v3: 6.8
unaffected_versions:
- "<OPTIONAL: FILL IN SEE BELOW>"
patched_versions:
- "<FILL IN SEE BELOW>"


# GitHub advisory data below - **Remove this data before committing**
# Use this data to write patched_versions (and potentially unaffected_versions) above
---
identifiers:
- type: GHSA
  value: GHSA-gxhx-g4fq-49hj
- type: CVE
  value: CVE-2023-49090
summary: CarrierWave Content-Type allowlist bypass vulnerability, possibly leading
  to XSS
description: "### Impact\n[CarrierWave::Uploader::ContentTypeAllowlist](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/content_type_allowlist.rb)
  has a Content-Type allowlist bypass vulnerability, possibly leading to XSS. \n\nThe
  validation in `allowlisted_content_type?` determines Content-Type permissions by
  performing a partial match.\nIf the `content_type` argument of `allowlisted_content_type?`
  is passed a value crafted by the attacker, Content-Types not included in the `content_type_allowlist`
  will be allowed.\n\nIn addition, by setting the Content-Type configured by the attacker
  at the time of file delivery, it is possible to cause XSS on the user's browser
  when the uploaded file is opened.\n\n### Patches\nUpgrade to [3.0.5](https://rubygems.org/gems/carrierwave/versions/3.0.5)
  or [2.2.5](https://rubygems.org/gems/carrierwave/versions/2.2.5).\n\n### Workarounds\nWhen
  validating with `allowlisted_content_type?` in [CarrierWave::Uploader::ContentTypeAllowlist](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/content_type_allowlist.rb)
  , forward match(`\\A`) the Content-Type set in `content_type_allowlist`, preventing
  unintentional permission of `text/html;image/png` when you want to allow only `image/png`
  in `content_type_allowlist`.\n\n### References\n[OWASP - File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html#content-type-validation)\n"
severity: MODERATE
cvss:
  score: 6.8
  vectorString: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:N/A:N
references:
- url: https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-gxhx-g4fq-49hj
- url: https://nvd.nist.gov/vuln/detail/CVE-2023-49090
- url: https://github.com/carrierwaveuploader/carrierwave/commit/39b282db5c1303899b3d3381ce8a837840f983b5
- url: https://github.com/carrierwaveuploader/carrierwave/commit/863d425c76eba12c3294227b39018f6b2dccbbf3
- url: https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/uploader/content_type_allowlist.rb
- url: https://rubygems.org/gems/carrierwave/versions/2.2.5
- url: https://rubygems.org/gems/carrierwave/versions/3.0.5
- url: https://github.com/advisories/GHSA-gxhx-g4fq-49hj
publishedAt: '2023-11-29T21:33:27Z'
withdrawnAt: 
vulnerabilities:
- package:
    name: carrierwave
    ecosystem: RUBYGEMS
  vulnerableVersionRange: "< 2.2.5"
  firstPatchedVersion:
    identifier: 2.2.5
- package:
    name: carrierwave
    ecosystem: RUBYGEMS
  vulnerableVersionRange: ">= 3.0.0, < 3.0.5"
  firstPatchedVersion:
    identifier: 3.0.5
